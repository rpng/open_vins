<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ov_core::FeatureDatabase class | OpenVINS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600&amp;subset=latin-ext" />
  <link rel="stylesheet" href="m-udel+documentation.compiled.css" />
  <link rel="stylesheet" href="custom.css" />
  <link rel="icon" href="favicon-light.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2f73a3" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OpenVINS</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="namespaceov__core.html">ov_core</a></li>
            <li><a href="namespaceov__type.html">ov_type</a></li>
            <li><a href="namespaceov__msckf.html">ov_msckf</a></li>
            <li><a href="namespaceov__init.html">ov_init</a></li>
            <li><a href="namespaceov__eval.html">ov_eval</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="8">
            <li><a href="https://github.com/rpng/open_vins/">GitHub</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="namespaceov__core.html">ov_core</a>::<wbr/></span>FeatureDatabase <span class="m-thin">class</span>
        </h1>
        <p>Database containing features we are currently tracking.</p>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#typeless-methods">Constructors, destructors, conversion operators</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
                <li><a href="#pro-attribs">Protected variables</a></li>
              </ul>
            </li>
          </ul>
        </div>
<p>Each visual tracker has this database in it and it contains all features that we are tracking. The trackers will insert information into this database when they get new measurements from doing tracking. A user would then query this database for features that can be used for update and remove them after they have been processed.</p><aside class="m-note m-warning"><h3>A Note on Multi-Threading Support</h3><p>There is some support for asynchronous multi-threaded access. Since each feature is a pointer just directly returning and using them is not thread safe. Thus, to be thread safe, use the &quot;remove&quot; flag for each function which will remove it from this feature database. This prevents the trackers from adding new measurements and editing the feature information. For example, if you are asynchronous tracking cameras and you chose to update the state, then remove all features you will use in update. The feature trackers will continue to add features while you update, whose measurements can be used in the next update step!</p></aside>
        <section id="typeless-methods">
          <h2><a href="#typeless-methods">Constructors, destructors, conversion operators</a></h2>
          <dl class="m-doc">
            <dt id="a26d81dfa410ec463172796cc9ae8cafd">
              <span class="m-doc-wrap-bumper"><a href="#a26d81dfa410ec463172796cc9ae8cafd" class="m-doc-self">FeatureDatabase</a>(</span><span class="m-doc-wrap">)</span>
            </dt>
            <dd>Default constructor.</dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a1ac4fc05c0638f1b1ad2a8821eb28459" class="m-doc">get_feature</a>(</span><span class="m-doc-wrap">size_t id,
              bool remove = false) -&gt; std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;</span>
            </dt>
            <dd>Get a specified feature.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a176738d7afc47d36cfcbac68cd07e920" class="m-doc">update_feature</a>(</span><span class="m-doc-wrap">size_t id,
              double timestamp,
              size_t cam_id,
              float u,
              float v,
              float u_n,
              float v_n)</span>
            </dt>
            <dd>Update a feature object.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a10e1bb043a10da1fc08425974e9684eb" class="m-doc">features_not_containing_newer</a>(</span><span class="m-doc-wrap">double timestamp,
              bool remove = false,
              bool skip_deleted = false) -&gt; std::vector&lt;std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt;</span>
            </dt>
            <dd>Get features that do not have newer measurement then the specified time.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a30ad8bcbf9158345ebefc7d5b5efef3a" class="m-doc">features_containing_older</a>(</span><span class="m-doc-wrap">double timestamp,
              bool remove = false,
              bool skip_deleted = false) -&gt; std::vector&lt;std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt;</span>
            </dt>
            <dd>Get features that has measurements older then the specified time.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#a762b36927e1dd59c4aa779ae7ed1ea01" class="m-doc">features_containing</a>(</span><span class="m-doc-wrap">double timestamp,
              bool remove = false,
              bool skip_deleted = false) -&gt; std::vector&lt;std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt;</span>
            </dt>
            <dd>Get features that has measurements at the specified time.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a81c64036a8e8a8f2dc00a88f55a8579f" class="m-doc">cleanup</a>(</span><span class="m-doc-wrap">)</span>
            </dt>
            <dd>This function will delete all features that have been used up.</dd>
            <dt id="a7d5f2db10740ce19a0a083c19f7656c9">
              <span class="m-doc-wrap-bumper">void <a href="#a7d5f2db10740ce19a0a083c19f7656c9" class="m-doc-self">cleanup_measurements</a>(</span><span class="m-doc-wrap">double timestamp)</span>
            </dt>
            <dd>This function will delete all feature measurements that are older then the specified timestamp.</dd>
            <dt id="aa8c4f253cb09d24c81fb968b28082235">
              <span class="m-doc-wrap-bumper">void <a href="#aa8c4f253cb09d24c81fb968b28082235" class="m-doc-self">cleanup_measurements_exact</a>(</span><span class="m-doc-wrap">double timestamp)</span>
            </dt>
            <dd>This function will delete all feature measurements that are at the specified timestamp.</dd>
            <dt id="ab9b243f8a439794e454bfb604061cb4a">
              <span class="m-doc-wrap-bumper">auto <a href="#ab9b243f8a439794e454bfb604061cb4a" class="m-doc-self">size</a>(</span><span class="m-doc-wrap">) -&gt; size_t</span>
            </dt>
            <dd>Returns the size of the feature database.</dd>
            <dt id="ad105b5cacc83eae1a5fb71f05b084294">
              <span class="m-doc-wrap-bumper">auto <a href="#ad105b5cacc83eae1a5fb71f05b084294" class="m-doc-self">get_internal_data</a>(</span><span class="m-doc-wrap">) -&gt; std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt;</span>
            </dt>
            <dd>Returns the internal data (should not normally be used)</dd>
            <dt id="acfd95190fe646e1bc2a45e9bb6704dea">
              <span class="m-doc-wrap-bumper">void <a href="#acfd95190fe646e1bc2a45e9bb6704dea" class="m-doc-self">append_new_measurements</a>(</span><span class="m-doc-wrap">const std::shared_ptr&lt;<a href="classov__core_1_1FeatureDatabase.html" class="m-doc">FeatureDatabase</a>&gt;&amp; database)</span>
            </dt>
            <dd>Will update the passed database with this database&#x27;s latest feature information.</dd>
          </dl>
        </section>
        <section id="pro-attribs">
          <h2><a href="#pro-attribs">Protected variables</a></h2>
          <dl class="m-doc">
            <dt id="abf963d2ada2d2263d0b9668ab3bb03b0">
              std::mutex <a href="#abf963d2ada2d2263d0b9668ab3bb03b0" class="m-doc-self">mtx</a>
            </dt>
            <dd>Mutex lock for our map.</dd>
            <dt id="a132a312f68e252936633bfaf4a1fc044">
              std::unordered_map&lt;size_t, std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt; <a href="#a132a312f68e252936633bfaf4a1fc044" class="m-doc-self">features_idlookup</a>
            </dt>
            <dd>Our lookup array that allow use to query based on ID.</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="a1ac4fc05c0638f1b1ad2a8821eb28459"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt; ov_core::<wbr />FeatureDatabase::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a1ac4fc05c0638f1b1ad2a8821eb28459" class="m-doc-self">get_feature</a>(</span><span class="m-doc-wrap">size_t id,
              bool remove = false)</span></span>
            </h3>
            <p>Get a specified feature.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">id</td>
                  <td>What feature we want to get</td>
                </tr>
                <tr>
                  <td>remove</td>
                  <td>Set to true if you want to remove the feature from the database (you will need to handle the freeing of memory)</td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <th>Returns</th>
                  <td>Either a feature object, or null if it is not in the database.</td>
                </tr>
              </tfoot>
            </table>
          </div></section>
          <section class="m-doc-details" id="a176738d7afc47d36cfcbac68cd07e920"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />FeatureDatabase::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a176738d7afc47d36cfcbac68cd07e920" class="m-doc-self">update_feature</a>(</span><span class="m-doc-wrap">size_t id,
              double timestamp,
              size_t cam_id,
              float u,
              float v,
              float u_n,
              float v_n)</span></span>
            </h3>
            <p>Update a feature object.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">id</td>
                  <td>ID of the feature we will update</td>
                </tr>
                <tr>
                  <td>timestamp</td>
                  <td>time that this measurement occured at</td>
                </tr>
                <tr>
                  <td>cam_id</td>
                  <td>which camera this measurement was from</td>
                </tr>
                <tr>
                  <td>u</td>
                  <td>raw u coordinate</td>
                </tr>
                <tr>
                  <td>v</td>
                  <td>raw v coordinate</td>
                </tr>
                <tr>
                  <td>u_n</td>
                  <td>undistorted/normalized u coordinate</td>
                </tr>
                <tr>
                  <td>v_n</td>
                  <td>undistorted/normalized v coordinate</td>
                </tr>
              </tbody>
            </table>
<p>This will update a given feature based on the passed ID it has. It will create a new feature, if it is an ID that we have not seen before.</p>
          </div></section>
          <section class="m-doc-details" id="a10e1bb043a10da1fc08425974e9684eb"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::vector&lt;std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt; ov_core::<wbr />FeatureDatabase::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a10e1bb043a10da1fc08425974e9684eb" class="m-doc-self">features_not_containing_newer</a>(</span><span class="m-doc-wrap">double timestamp,
              bool remove = false,
              bool skip_deleted = false)</span></span>
            </h3>
            <p>Get features that do not have newer measurement then the specified time.</p>
<p>This function will return all features that do not a measurement at a time greater than the specified time. For example this could be used to get features that have not been successfully tracked into the newest frame. All features returned will not have any measurements occurring at a time greater then the specified.</p>
          </div></section>
          <section class="m-doc-details" id="a30ad8bcbf9158345ebefc7d5b5efef3a"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::vector&lt;std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt; ov_core::<wbr />FeatureDatabase::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a30ad8bcbf9158345ebefc7d5b5efef3a" class="m-doc-self">features_containing_older</a>(</span><span class="m-doc-wrap">double timestamp,
              bool remove = false,
              bool skip_deleted = false)</span></span>
            </h3>
            <p>Get features that has measurements older then the specified time.</p>
<p>This will collect all features that have measurements occurring before the specified timestamp. For example, we would want to remove all features older then the last clone/state in our sliding window.</p>
          </div></section>
          <section class="m-doc-details" id="a762b36927e1dd59c4aa779ae7ed1ea01"><div>
            <h3>
              <span class="m-doc-wrap-bumper">std::vector&lt;std::shared_ptr&lt;<a href="classov__core_1_1Feature.html" class="m-doc">Feature</a>&gt;&gt; ov_core::<wbr />FeatureDatabase::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a762b36927e1dd59c4aa779ae7ed1ea01" class="m-doc-self">features_containing</a>(</span><span class="m-doc-wrap">double timestamp,
              bool remove = false,
              bool skip_deleted = false)</span></span>
            </h3>
            <p>Get features that has measurements at the specified time.</p>
<p>This function will return all features that have the specified time in them. This would be used to get all features that occurred at a specific clone/state.</p>
          </div></section>
          <section class="m-doc-details" id="a81c64036a8e8a8f2dc00a88f55a8579f"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />FeatureDatabase::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a81c64036a8e8a8f2dc00a88f55a8579f" class="m-doc-self">cleanup</a>(</span><span class="m-doc-wrap">)</span></span>
            </h3>
            <p>This function will delete all features that have been used up.</p>
<p>If a feature was unable to be used, it will still remain since it will not have a delete flag set</p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.16 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
