<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ov_core::TrackDescriptor class | OpenVINS</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600&amp;subset=latin-ext" />
  <link rel="stylesheet" href="m-udel+documentation.compiled.css" />
  <link rel="stylesheet" href="custom.css" />
  <link rel="icon" href="favicon-light.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2f73a3" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">OpenVINS</a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="namespaceov__core.html">ov_core</a></li>
            <li><a href="namespaceov__eval.html">ov_eval</a></li>
            <li><a href="namespaceov__msckf.html">ov_msckf</a></li>
            <li><a href="annotated.html">Classes</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="6">
            <li><a href="https://github.com/rpng/open_vins/">GitHub</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          <span class="m-breadcrumb"><a href="namespaceov__core.html">ov_core</a>::<wbr/></span>TrackDescriptor <span class="m-thin">class</span>
        </h1>
        <p>Descriptor-based visual tracking.</p>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#base-classes">Base classes</a></li>
                <li><a href="#typeless-methods">Constructors, destructors, conversion operators</a></li>
                <li><a href="#pub-methods">Public functions</a></li>
                <li><a href="#pro-methods">Protected functions</a></li>
              </ul>
            </li>
          </ul>
        </div>
<p>Here we use descriptor matching to track features from one frame to the next. We track both temporally, and across stereo pairs to get stereo constraints. Right now we use ORB descriptors as we have found it is the fastest when computing descriptors. Tracks are then rejected based on a ratio test and ransac.</p>
        <section id="base-classes">
          <h2><a href="#base-classes">Base classes</a></h2>
          <dl class="m-doc">
            <dt>
              class <a href="classov__core_1_1TrackBase.html" class="m-doc">TrackBase</a>
            </dt>
            <dd>Visual feature tracking base class.</dd>
          </dl>
        </section>
        <section id="typeless-methods">
          <h2><a href="#typeless-methods">Constructors, destructors, conversion operators</a></h2>
          <dl class="m-doc">
            <dt id="a7919083618879b11084801f6f6bffee7">
              <span class="m-doc-wrap-bumper"><a href="#a7919083618879b11084801f6f6bffee7" class="m-doc-self">TrackDescriptor</a>(</span><span class="m-doc-wrap">)</span>
            </dt>
            <dd>Public default constructor.</dd>
            <dt>
              <span class="m-doc-wrap-bumper"><a href="#ac4472d91b07ec6e3d0e74510065e881d" class="m-doc">TrackDescriptor</a>(</span><span class="m-doc-wrap">int numfeats,
              int numaruco,
              int fast_threshold,
              int gridx,
              int gridy,
              double knnratio) <span class="m-label m-flat m-info">explicit</span> </span>
            </dt>
            <dd>Public constructor with configuration variables.</dd>
          </dl>
        </section>
        <section id="pub-methods">
          <h2><a href="#pub-methods">Public functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a656e6ee940a7eb38337dda44c2bea595" class="m-doc">feed_monocular</a>(</span><span class="m-doc-wrap">double timestamp,
              cv::Mat&amp; img,
              size_t cam_id) <span class="m-label m-flat m-warning">override</span></span>
            </dt>
            <dd>Process a new monocular image.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#a881995c901ca511114bddb6bbe38ac2e" class="m-doc">feed_stereo</a>(</span><span class="m-doc-wrap">double timestamp,
              cv::Mat&amp; img_left,
              cv::Mat&amp; img_right,
              size_t cam_id_left,
              size_t cam_id_right) <span class="m-label m-flat m-warning">override</span></span>
            </dt>
            <dd>Process new stereo pair of images.</dd>
          </dl>
        </section>
        <section id="pro-methods">
          <h2><a href="#pro-methods">Protected functions</a></h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#ab99f5748c2ba1f2a40ab45f18f5230e5" class="m-doc">perform_detection_monocular</a>(</span><span class="m-doc-wrap">const cv::Mat&amp; img0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              cv::Mat&amp; desc0,
              std::vector&lt;size_t&gt;&amp; ids0)</span>
            </dt>
            <dd>Detects new features in the current image.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#afbc5d5b1d173c6ea49a06eab4d2e2a94" class="m-doc">perform_detection_stereo</a>(</span><span class="m-doc-wrap">const cv::Mat&amp; img0,
              const cv::Mat&amp; img1,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts1,
              cv::Mat&amp; desc0,
              cv::Mat&amp; desc1,
              size_t cam_id0,
              size_t cam_id1,
              std::vector&lt;size_t&gt;&amp; ids0,
              std::vector&lt;size_t&gt;&amp; ids1)</span>
            </dt>
            <dd>Detects new features in the current stereo pair.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#ae9ce4b08e54d7a8a62d69417695a66ef" class="m-doc">robust_match</a>(</span><span class="m-doc-wrap">std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt; pts1,
              cv::Mat&amp; desc0,
              cv::Mat&amp; desc1,
              size_t id0,
              size_t id1,
              std::vector&lt;cv::DMatch&gt;&amp; matches)</span>
            </dt>
            <dd>Find matches between two keypoint+descriptor sets.</dd>
          </dl>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="ac4472d91b07ec6e3d0e74510065e881d"><div>
            <h3>
              <span class="m-doc-wrap-bumper"> ov_core::<wbr />TrackDescriptor::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ac4472d91b07ec6e3d0e74510065e881d" class="m-doc-self">TrackDescriptor</a>(</span><span class="m-doc-wrap">int numfeats,
              int numaruco,
              int fast_threshold,
              int gridx,
              int gridy,
              double knnratio) <span class="m-label m-info">explicit</span> </span></span>
            </h3>
            <p>Public constructor with configuration variables.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">numfeats</td>
                  <td>number of features we want want to track (i.e. track 200 points from frame to frame)</td>
                </tr>
                <tr>
                  <td>numaruco</td>
                  <td>the max id of the arucotags, so we ensure that we start our non-auroc features above this value</td>
                </tr>
                <tr>
                  <td>fast_threshold</td>
                  <td>FAST detection threshold</td>
                </tr>
                <tr>
                  <td>gridx</td>
                  <td>size of grid in the x-direction / u-direction</td>
                </tr>
                <tr>
                  <td>gridy</td>
                  <td>size of grid in the y-direction / v-direction</td>
                </tr>
                <tr>
                  <td>knnratio</td>
                  <td>matching ratio needed (smaller value forces top two descriptors during match to be more different)</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a656e6ee940a7eb38337dda44c2bea595"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackDescriptor::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a656e6ee940a7eb38337dda44c2bea595" class="m-doc-self">feed_monocular</a>(</span><span class="m-doc-wrap">double timestamp,
              cv::Mat&amp; img,
              size_t cam_id) <span class="m-label m-warning">override</span></span></span>
            </h3>
            <p>Process a new monocular image.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">timestamp</td>
                  <td>timestamp the new image occurred at</td>
                </tr>
                <tr>
                  <td>img</td>
                  <td>new cv:Mat grayscale image</td>
                </tr>
                <tr>
                  <td>cam_id</td>
                  <td>the camera id that this new image corresponds too</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="a881995c901ca511114bddb6bbe38ac2e"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackDescriptor::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#a881995c901ca511114bddb6bbe38ac2e" class="m-doc-self">feed_stereo</a>(</span><span class="m-doc-wrap">double timestamp,
              cv::Mat&amp; img_left,
              cv::Mat&amp; img_right,
              size_t cam_id_left,
              size_t cam_id_right) <span class="m-label m-warning">override</span></span></span>
            </h3>
            <p>Process new stereo pair of images.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">timestamp</td>
                  <td>timestamp this pair occured at (stereo is synchronised)</td>
                </tr>
                <tr>
                  <td>img_left</td>
                  <td>first grayscaled image</td>
                </tr>
                <tr>
                  <td>img_right</td>
                  <td>second grayscaled image</td>
                </tr>
                <tr>
                  <td>cam_id_left</td>
                  <td>first image camera id</td>
                </tr>
                <tr>
                  <td>cam_id_right</td>
                  <td>second image camera id</td>
                </tr>
              </tbody>
            </table>
          </div></section>
          <section class="m-doc-details" id="ab99f5748c2ba1f2a40ab45f18f5230e5"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackDescriptor::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ab99f5748c2ba1f2a40ab45f18f5230e5" class="m-doc-self">perform_detection_monocular</a>(</span><span class="m-doc-wrap">const cv::Mat&amp; img0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              cv::Mat&amp; desc0,
              std::vector&lt;size_t&gt;&amp; ids0) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Detects new features in the current image.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">img0</td>
                  <td>image we will detect features on</td>
                </tr>
                <tr>
                  <td>pts0</td>
                  <td>vector of extracted keypoints</td>
                </tr>
                <tr>
                  <td>desc0</td>
                  <td>vector of the extracted descriptors</td>
                </tr>
                <tr>
                  <td>ids0</td>
                  <td>vector of all new IDs</td>
                </tr>
              </tbody>
            </table>
<p>Given a set of images, and their currently extracted features, this will try to add new features. We return all extracted descriptors here since we DO NOT need to do stereo tracking left to right. Our vector of IDs will be later overwritten when we match features temporally to the previous frame&#x27;s features. See <a href="classov__core_1_1TrackDescriptor.html#ae9ce4b08e54d7a8a62d69417695a66ef" class="m-doc">robust_<wbr />match()</a> for the matching.</p>
          </div></section>
          <section class="m-doc-details" id="afbc5d5b1d173c6ea49a06eab4d2e2a94"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackDescriptor::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#afbc5d5b1d173c6ea49a06eab4d2e2a94" class="m-doc-self">perform_detection_stereo</a>(</span><span class="m-doc-wrap">const cv::Mat&amp; img0,
              const cv::Mat&amp; img1,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt;&amp; pts1,
              cv::Mat&amp; desc0,
              cv::Mat&amp; desc1,
              size_t cam_id0,
              size_t cam_id1,
              std::vector&lt;size_t&gt;&amp; ids0,
              std::vector&lt;size_t&gt;&amp; ids1) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Detects new features in the current stereo pair.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">img0</td>
                  <td>left image we will detect features on</td>
                </tr>
                <tr>
                  <td>img1</td>
                  <td>right image we will detect features on</td>
                </tr>
                <tr>
                  <td>pts0</td>
                  <td>left vector of new keypoints</td>
                </tr>
                <tr>
                  <td>pts1</td>
                  <td>right vector of new keypoints</td>
                </tr>
                <tr>
                  <td>desc0</td>
                  <td>left vector of extracted descriptors</td>
                </tr>
                <tr>
                  <td>desc1</td>
                  <td>left vector of extracted descriptors</td>
                </tr>
                <tr>
                  <td>cam_id0</td>
                  <td>id of the first camera</td>
                </tr>
                <tr>
                  <td>cam_id1</td>
                  <td>id of the second camera</td>
                </tr>
                <tr>
                  <td>ids0</td>
                  <td>left vector of all new IDs</td>
                </tr>
                <tr>
                  <td>ids1</td>
                  <td>right vector of all new IDs</td>
                </tr>
              </tbody>
            </table>
<p>This does the same logic as the <a href="classov__core_1_1TrackDescriptor.html#ab99f5748c2ba1f2a40ab45f18f5230e5" class="m-doc">perform_<wbr />detection_<wbr />monocular()</a> function, but we also enforce stereo contraints. We also do STEREO matching from the left to right, and only return good matches that are found in both the left and right. Our vector of IDs will be later overwritten when we match features temporally to the previous frame&#x27;s features. See <a href="classov__core_1_1TrackDescriptor.html#ae9ce4b08e54d7a8a62d69417695a66ef" class="m-doc">robust_<wbr />match()</a> for the matching.</p>
          </div></section>
          <section class="m-doc-details" id="ae9ce4b08e54d7a8a62d69417695a66ef"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void ov_core::<wbr />TrackDescriptor::<wbr /></span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#ae9ce4b08e54d7a8a62d69417695a66ef" class="m-doc-self">robust_match</a>(</span><span class="m-doc-wrap">std::vector&lt;cv::KeyPoint&gt;&amp; pts0,
              std::vector&lt;cv::KeyPoint&gt; pts1,
              cv::Mat&amp; desc0,
              cv::Mat&amp; desc1,
              size_t id0,
              size_t id1,
              std::vector&lt;cv::DMatch&gt;&amp; matches) <span class="m-label m-warning">protected</span></span></span>
            </h3>
            <p>Find matches between two keypoint+descriptor sets.</p>
            <table class="m-table m-fullwidth m-flat">
              <thead>
                <tr><th colspan="2">Parameters</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td style="width: 1%">pts0</td>
                  <td>first vector of keypoints</td>
                </tr>
                <tr>
                  <td>pts1</td>
                  <td>second vector of keypoints</td>
                </tr>
                <tr>
                  <td>desc0</td>
                  <td>first vector of descriptors</td>
                </tr>
                <tr>
                  <td>desc1</td>
                  <td>second vector of decriptors</td>
                </tr>
                <tr>
                  <td>id0</td>
                  <td>id of the first camera</td>
                </tr>
                <tr>
                  <td>id1</td>
                  <td>id of the second camera</td>
                </tr>
                <tr>
                  <td>matches</td>
                  <td>vector of matches that we have found</td>
                </tr>
              </tbody>
            </table>
<p>This will perform a &quot;robust match&quot; between the two sets of points (slow but has great results). First we do a simple KNN match from 1to2 and 2to1, which is followed by a ratio check and symmetry check. Original code is from the &quot;RobustMatcher&quot; in the opencv examples, and seems to give very good results in the matches. <a href="https://github.com/opencv/opencv/blob/master/samples/cpp/tutorial_code/calib3d/real_time_pose_estimation/src/RobustMatcher.cpp">https://github.com/opencv/opencv/blob/master/samples/cpp/tutorial_<wbr />code/calib3d/real_<wbr />time_<wbr />pose_<wbr />estimation/src/RobustMatcher.cpp</a></p>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Generated by <a href="https://doxygen.org/">Doxygen</a> 1.8.16 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
